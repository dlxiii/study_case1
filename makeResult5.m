% present daliy water age

clear all;
clearvars; clc;

% delete('diary')
% diary on;
% Which system am I using?
if ismac        % On Mac
    basedir = '/Users/yulong/GitHub/';
    addpath([basedir,'fvcomtoolbox/custom/']);
    addpath([basedir,'fvcomtoolbox/utilities/']);
elseif isunix	% Unix?
    basedir = '/home/usr0/n70110d/';
    addpath([basedir,'github/fvcomtoolbox/custom/']);
    addpath([basedir,'github/fvcomtoolbox/utilities/']);
elseif ispc     % Or Windows?
    basedir = 'C:/Users/Yulong WANG/Documents/GitHub/';      
    addpath([basedir,'fvcom-toolbox/custom/']);
    addpath([basedir,'fvcom-toolbox/utilities/']);
end
%%
matfile = '/Volumes/Yulong/GitHub/paper_case/low_resolution_2020/run/mScripts/mobj.mat';
load(matfile);
fprintf(['mat file at:',matfile,'\n']);
ncfile = '/Volumes/Yulong/GitHub/paper_case/low_resolution_2020/run/mScripts/ncfile.mat';
load(ncfile);
fprintf(['mat file at:',ncfile,'\n']);
%% 
%%%------------------------------------------------------------------------
%%%           (MEAN) DALIY WATER AGE SURFACE PLOTTING
%%%------------------------------------------------------------------------
dtid = [...
    2014,07,01,2014,07,02;...
    2014,07,08,2014,07,08;...
    2014,07,15,2014,07,15;...
    2014,07,22,2014,07,24;...
    2014,07,28,2014,07,29;...
    2014,08,08,2014,08,08;...
    2014,08,19,2014,08,19;...
    2014,08,25,2014,08,26;...
    2014,09,01,2014,09,01;...
    2014,09,09,2014,09,10;...
    2014,09,16,2014,09,17;...
    2014,09,23,2014,09,24;...
    2014,10,01,2014,10,01;...
    2014,10,08,2014,10,08;...
    2014,10,20,2014,10,20;...
    2014,10,27,2014,10,28;...
    2014,11,06,2014,11,08;...
    2014,11,25,2014,11,25;...
    2014,12,09,2014,12,10;...
    2014,12,19,2014,12,19;...
    2015,05,07,2015,05,08;...
    2015,05,18,2015,05,20;...
    2015,05,26,2015,05,26;...
    2015,06,01,2015,06,02;...
    2015,06,15,2015,06,16;...
    2015,06,23,2015,06,24;...
    2015,06,29,2015,06,30;...
    2015,07,06,2015,07,06;...
    2015,07,21,2015,07,22;...
    2015,07,28,2015,07,28;...
    2015,08,03,2015,08,05;...
    2015,08,11,2015,08,12;...
    2015,08,20,2015,08,20;...
    2015,08,25,2015,08,25;...
    2015,09,01,2015,09,02;...
    2015,09,10,2015,09,10;...
    2015,09,15,2015,09,15;...
    2015,09,24,2015,09,24;...
    2015,09,29,2015,09,29;...
    2015,10,05,2015,10,05;...
    2015,10,13,2015,10,13;...
    2015,10,19,2015,10,19;...
    2015,10,27,2015,10,27;...
    2015,11,04,2015,11,04;...
    2015,11,16,2015,11,16;...
    2015,11,30,2015,11,30;...
    2015,12,07,2015,12,07;...
    ];
for id = 1:size(dtid,1)
    k1 = find(ncfile.time == mjuliandate(dtid(id,1),dtid(id,2),dtid(id,3)));
    k2 = find(ncfile.time == mjuliandate(dtid(id,4),dtid(id,5),dtid(id,6)));
    water_age = double(mean(ncfile.age(:,1,k1:k2),3,'omitnan'));
    
    data = scatteredInterpolant(...
        ncfile.lon,...
        ncfile.lat,...
        water_age,...
        'natural');
    lonint = (139.14:0.001:140.39)';
    latint = (34.85:0.001:35.70)';
    AGEint = data({lonint,latint});

    % Create figure
    figure1 = figure(1);
    clf
    % Create axes
    axes1 = axes('Parent',figure1);
    hold(axes1,'on');
    [C,h] = contourf(...
        lonint,...
        latint,...
        AGEint',...
        [0,5,10,15,20,25,30,35,40,45,50,55,60,65,70,75,80]);
    v = [0,5,10,15,20,25,30,35,40,45,50,55,60,65,70,75,80];
    clabel(C,h,v,'FontSize',12,'FontName','Times','Color','black');
    hold on;
    file = "/Users/yulong/GitHub/OceanMesh2D/datasets/C23-06_TOKYOBAY.shp";
    s = shaperead(file);
    mapshow(s);
    % Uncomment the following line to preserve the X-limits of the axes
    xlim(axes1,[139.3 140.3]);
    % Uncomment the following line to preserve the Y-limits of the axes
    ylim(axes1,[34.85 35.75]);
    % Create ylabel
    ylabel('Latitude (degree)');
    % Create xlabel
    xlabel('Longtitude (degree)');
    % Create title
    % title([DateString, ': ', 'water ',NAME_ITEM, ' of ', NAME_LOCATION, ' ', item]);
    box(axes1,'on');

    print(gcf,['./Results/present/Age_DO/',...
        'AGE_',num2str(dtid(id,1)),num2str(dtid(id,2)),num2str(dtid(id,3)),'.png'],'-dpng','-r600');
    savefig(['./Results/present/Age_DO/',...
        'AGE_',num2str(dtid(id,1)),num2str(dtid(id,2)),num2str(dtid(id,3)),'.fig']);
end